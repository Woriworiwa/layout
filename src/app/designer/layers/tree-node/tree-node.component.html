@if (matchesSearch()) {
  <div
    class="tree-node-wrapper"
    [class.selected]="isSelected()"
    [style]="indentStyle"
    (click)="selectItem($event)"
    (contextmenu)="onContextMenu($event)">

    <!-- Expand/Collapse Toggle -->
    <button
      type="button"
      class="tree-node-toggle"
      [class.invisible]="!hasChildren()"
      (click)="toggleExpand(); $event.stopPropagation()">
      <i
        class="pi"
        [class.pi-chevron-right]="!isExpanded()"
        [class.pi-chevron-down]="isExpanded()"></i>
    </button>

    <!-- Icon -->
    <i [class]="icon()" class="tree-node-icon"></i>

    <!-- Label -->
    <span class="tree-node-label">{{ displayLabel() }}</span>
  </div>

  <!-- Children -->
  @if (hasChildren() && isExpanded()) {
    <div class="tree-node-children">
      @for (child of item().children; track child.key) {
        <app-tree-node
          [item]="child"
          [level]="level() + 1"
          [selectedKey]="selectedKey()"
          [expandedKeys]="expandedKeys()"
          [searchTerm]="searchTerm()"
          (itemSelected)="itemSelected.emit($event)"
          (itemExpanded)="itemExpanded.emit($event)"
          (itemContextMenu)="itemContextMenu.emit($event)">
        </app-tree-node>
      }
    </div>
  }
}
