<div class="relative h-full w-full">
  <p-tree
    class="w-full"
    [dt]="themeOverrides"
    [value]="treeNodes"
    ngDefaultControl
    [contextMenu]="contextMenu"
    [(selection)]="selectedItems"
    selectionMode="single"
    (selectionChange)="onTreeSelectionChanged($event)"
    [draggableNodes]="true"
    [droppableNodes]="true"
    draggableScope="self"
    droppableScope="self"
    (onNodeContextMenuSelect)="onNodeContextMenu($event)"
    (onNodeExpand)="onNodeExpand($event)"
    (onNodeDrop)="onNodeDrop()"
  >
  </p-tree>

  @if (showGuidanceMessage) {
    <div
      class="absolute top-2 left-2 right-2 flex items-center gap-2 px-3 py-2 rounded-md shadow-sm pointer-events-none z-[1000] opacity-90 text-[11px] bg-primary text-primary-contrast"
      [@fadeInOut]
    >
      <i class="pi pi-arrows-alt text-[12px]"></i>
      <span class="whitespace-nowrap overflow-hidden text-ellipsis"
        >Use the layers tree to reorder elements</span
      >
    </div>
  }
</div>

<p-contextMenu #contextMenu [model]="contextMenuItems"></p-contextMenu>

<p-popover #renameItem>
  <input
    #nameInput
    pInputText

    (keydown.enter)="renameNode(selectedItems?.key!, nameInput.value)"
    onfocus="this.select()"
    [value]="selectedItems?.label || selectedItems?.itemType"
  />

  <div class="rename-button-container">
    <p-button
      type="button"
      label="Cancel"
      [text]="true"
      (click)="renameItem.hide()"
    ></p-button>
    <p-button
      type="submit"
      label="Rename"
      (click)="renameNode(selectedItems?.key!, nameInput.value)"
    ></p-button>
  </div>
</p-popover>
